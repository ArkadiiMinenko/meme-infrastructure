ğŸš€ Step 1 â€” Infrastructure Foundation
Terraform Ã— Proxmox Ã— Reality Check
Context

This project is a DevOps homelab built with one clear intention:
to design infrastructure that behaves like production, not like a demo.

No managed services.
No hidden automation.
Full control over virtualization, networking, and provisioning.

Before touching Kubernetes, GitOps, or CI/CD, the foundation has to be solid.

This step is about building that foundation.

ğŸ¯ Goals of Step 1

Understand how Proxmox actually manages VM lifecycle

Set up Terraform locally as the single source of truth for infrastructure

Eliminate manual VM creation and UI-driven configuration

Prepare a clean base for future Kubernetes nodes

This step was less about speed â€” and more about learning the platformâ€™s edges.

ğŸ§± What Was Built
Proxmox Side

Imported an Ubuntu cloud-init image

Converted it into a reusable VM template

Verified:

disk layout and boot mode (SeaBIOS)

virtio storage and networking

cloud-init compatibility

Terraform Side

Configured Terraform to control Proxmox via API

Described VM configuration entirely in code:

CPU and RAM limits

static IPs via cloud-init

SSH access using public keys

Ensured infrastructure could be recreated from scratch at any time

At this point, the goal was simple:
ğŸ‘‰ terraform apply should produce a usable VM â€” every time.

âš ï¸ What Went Wrong (and Why It Mattered)
1. Terraform Hanging on Still creating...

Terraform would wait indefinitely, even though the VM was already running.

Why?
Terraform relies on QEMU Guest Agent to receive the VMâ€™s IP address and mark it as â€œreadyâ€.
No agent â†’ no signal â†’ Terraform waits forever.

Fix:

Installed and enabled qemu-guest-agent in the template

Enabled agent support in Proxmox

2. PXE Boot Instead of Disk Boot

Some VMs didnâ€™t boot at all and dropped straight into PXE.

Symptoms:

Boot failed: could not read the boot disk

Root disk attached as unused0

scsi0 missing

cloud-init CDROM not connected

What actually happened:
The Terraform provider created the disk, but failed to attach it correctly.
Result: a VM that exists, but cannot boot.

Temporary fixes were possible via qm set, butâ€¦

3. The Real Issue: Provider Instability

The initial Proxmox Terraform provider showed:

inconsistent VM definitions

provider crashes

partial resource creation

repeated manual intervention

At this point, the problem was no longer configuration â€”
it was tool reliability.

ğŸ§  Engineering Decision

Instead of stacking workarounds and post-create scripts, the decision was made to:

Replace the provider.

Sometimes the most correct solution is not a clever workaround,
but choosing a tool that behaves predictably.

This immediately stabilized the provisioning process.

âœ… Outcome of Step 1

Terraform provisions Proxmox VMs reliably

No manual fixes required after creation

VM state is fully reproducible from code

Infrastructure is ready for Kubernetes bootstrap

Most importantly:
the foundation is now trusted.

ğŸ“Œ Key Takeaways

Infrastructure as Code does not hide platform behavior â€” it reveals it

Minimal cloud images require deliberate preparation

Terraform is only as reliable as the signals it receives

Knowing when to switch tools is as important as knowing how to configure them